<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Milkdromeda Search</title>
  <style>
    :root{
      --page-bg: #f3f6fb;     /* soft neutral light background */
      --card-bg: #ffffff;     /* white card */
      --accent: #0078d4;      /* Bing-like blue */
      --muted: #6b7280;
      --text: #0b2336;
      --surface: #f7fafc;
      --border: rgba(11,35,54,0.06);
    }

    /* page */
    html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Arial,sans-serif;background:var(--page-bg);color:var(--text)}
    .wrap{max-width:1040px;margin:40px auto;padding:20px;box-sizing:border-box}

    /* card */
    .card{
      background:var(--card-bg);
      border-radius:12px;
      padding:20px;
      box-shadow:0 6px 18px rgba(11,35,54,0.04);
      border:1px solid var(--border);
    }

    /* header */
    .header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand h1{margin:0;font-size:20px;color:var(--accent);letter-spacing:0.2px}
    .brand p{margin:0;font-size:13px;color:var(--muted)}

    /* controls */
    .controls{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:18px}
    .controls input[type="text"]{
      flex:1;min-width:260px;padding:12px 14px;border-radius:8px;border:1px solid var(--border);font-size:15px;background:var(--surface)
    }
    .btn{padding:10px 14px;border-radius:8px;border:0;cursor:pointer;font-weight:700}
    .btn.primary{background:var(--accent);color:#fff}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(0,120,212,0.12)}

    /* layout */
    .grid{display:grid;grid-template-columns:1fr 320px;gap:18px}
    @media (max-width:880px){ .grid{grid-template-columns:1fr} }

    .panel{background:var(--card-bg);border-radius:10px;padding:14px;border:1px solid var(--border)}
    .panel h3{margin:0 0 8px 0;font-size:15px;color:var(--accent)}
    .lead{margin:0 0 10px 0;color:var(--muted);font-size:13px}

    .overview{min-height:96px;padding:12px;border-radius:8px;background:var(--surface);font-size:14px;color:var(--text)}
    .links{display:flex;flex-direction:column;gap:10px}
    .link{padding:10px;border-radius:8px;background:#ffffff;border:1px solid var(--border)}
    .link .title{font-weight:700;color:#0b3b66;font-size:14px}
    .link .desc{margin-top:6px;color:var(--muted);font-size:13px}

    .footer{margin-top:16px;font-size:12px;color:var(--muted);display:flex;justify-content:space-between}

    /* dark mode: solid colors only, no gradients */
    body.dark-mode{
      --page-bg: #0b1016;
      --card-bg: #07101a;
      --accent: #4aa3ff;
      --muted: #9bbfe6;
      --text: #e6f6ff;
      --surface: #05121a;
      --border: rgba(74,163,255,0.08);
    }
    body.dark-mode .card{box-shadow:none;border:1px solid rgba(255,255,255,0.03)}
    body.dark-mode .controls input[type="text"]{background:var(--surface);border:1px solid rgba(255,255,255,0.04);color:var(--text)}
    body.dark-mode .link{background:var(--surface);border:1px solid rgba(255,255,255,0.03)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="main">
      <div class="header">
        <div class="brand">
          <div>
            <h1>Milkdromeda Search</h1>
            <p>Fast search and AI summaries for your studio notes and game topics</p>
          </div>
        </div>

        <div style="display:flex;gap:8px;align-items:center">
          <button id="dark-mode-toggle" class="btn ghost" aria-pressed="false" type="button">Dark Mode</button>
        </div>
      </div>

      <div class="controls" role="search" aria-label="site search">
        <input id="query" type="text" placeholder="Search (e.g. Blade Ball Void Sword AFK farm)" aria-label="query input" />
        <button id="search-btn" class="btn primary" type="button">Search</button>
        <button id="clear-btn" class="btn ghost" type="button">Clear</button>
      </div>

      <div class="grid">
        <div>
          <div class="panel" aria-live="polite">
            <h3>AI Overview</h3>
            <p class="lead">Short AI-generated summary appears here first.</p>
            <div id="overview" class="overview">No overview yet. Enter a query and press Search.</div>
          </div>

          <div style="height:14px"></div>

          <div class="panel">
            <h3>Links with descriptions</h3>
            <p class="lead">AI-curated links and short descriptions.</p>
            <div id="links" class="links"></div>
          </div>
        </div>

        <aside>
          <div class="panel">
            <h3>Quick actions</h3>
            <p class="lead">Download results or check backend status.</p>
            <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
              <button id="download-btn" class="btn ghost" type="button">Download JSON</button>
              <button id="test-backend" class="btn ghost" type="button">Check Backend</button>
            </div>
          </div>

          <div style="height:14px"></div>

          <div class="panel">
            <h3>About</h3>
            <p class="lead">Â© <span id="year"></span> Milkdromeda Studios</p>
          </div>
        </aside>
      </div>

      <div class="footer">
        <div>Milkdromeda Search UI</div>
        <div>Secure backend required</div>
      </div>
    </div>
  </div>

 <script>
  // Replace with your actual Render backend URL
  const API_BASE = "https://milkdromeda-backend.onrender.com";

  async function safeJsonFetch(path, body=null) {
    const url = API_BASE + path;
    const opts = body ? {
      method: 'POST',
      headers: { 'Accept':'application/json','Content-Type':'application/json' },
      body: JSON.stringify(body)
    } : { method: 'GET' };
    const res = await fetch(url, opts);
    const text = await res.text();
    return text ? JSON.parse(text) : null;
  }

  async function doSearch() {
    const q = document.getElementById("query").value.trim();
    if (!q) return;

    // Overview
    const ov = await safeJsonFetch("/api/overview", { query: q });
    document.getElementById("overview").textContent =
      ov?.result || "No overview returned.";

    // Links
    const lk = await safeJsonFetch("/api/search", { query: q });
    const links = Array.isArray(lk?.results) ? lk.results : [];
    const out = document.getElementById("links");
    out.innerHTML = "";
    links.forEach(item => {
      const div = document.createElement("div");
      div.innerHTML = `<strong>${item.title}</strong><br>${item.description}`;
      out.appendChild(div);
    });
  }

  document.getElementById("search-btn").addEventListener("click", doSearch);
</script>
</body>
</html>
